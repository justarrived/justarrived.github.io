<div class="form-col form-col--full-width">
  <div class="input-group">
    <div class="input-group-content">
      <p>
        {% t form.salary %} <span class="asterisk">*</span>
      </p>

      <ul id="js-hourly-salary-input-target"></ul>

    </div>
  </div>
</div>

<!-- START: HTML TEMPLATE -->
<div id="js-hourly-salary-input-template" style="display:none;">
  <input type="radio" value="%grossval%" name="gross_salary" id="salary-value-%val%" required>
  <label for="salary-value-%val%">%val% SEK/h</label>
</div>
<!-- END: HTML TEMPLATE -->

<script type="text/javascript">
  (function(window) {
    JA_API_URL = 'https://api.justarrived.se/api/v1';
    HOURLY_PAYS_ENDPOINT = JA_API_URL + '/hourly-pays?sort=gross-salary';

    function getHourlyPays(callback) {
      $.getJSON(HOURLY_PAYS_ENDPOINT, function(response) {
        callback(response.data);
      });
    }

    function createInputList(options) {
      var opts = {
        targetSelector: options.targetSelector,
        inputTemplate: options.inputTemplate,
      };

      var $inputListTarget = $(opts.targetSelector);
      var $inputTemplate = $(opts.inputTemplate);

      if ($inputListTarget.length === 0 || $inputTemplate.length === 0) {
        return;
      }

      var templateHTML = $inputTemplate.html().toString();
      var inputList = [];

      getHourlyPays(function(hourlyPays) {
        for (var i = 0; i < hourlyPays.length; i++) {
          var hourlyPay = hourlyPays[i].attributes;
          var exVATValue = hourlyPay['rate-excluding-vat'];
          var grossValue = hourlyPay['gross-salary'];
          var inputHTML = templateHTML.replace(/%val%/g, exVATValue);
          inputHTML = inputHTML.replace(/%grossval%/g, grossValue);

          inputList.push('<li>' + inputHTML + '</li>');
        }

        $inputListTarget.append(inputList.join(''));
      });
    }

    window.HourlyPaysInput = {
      createInputList: createInputList
    }
  })(window);
</script>
